
<div id="skullWall">
<div id="skullDisplayContainer">
	{{# skulls}}
		<div class="parentSkull">
            <div class="{{slug}}">
				<li class="slug">{{slug}}</li>
				<div class="kudos"><span class="candlesCount">{{candles}}</span></div>
				<div class="skullImage"><img src="{{skull}}" width="175"></div>
				<div class="skullName"><h2>{{name}}</h2></div>
            </div>
		</div>
	{{/ skulls}}
</div>
</div>

<script>
$(document).ready(function (){
	

        //get number in kudos and determine which image
        //to replace that number

        window.onload = replaceKudosNumberWithImage();

        function replaceKudosNumberWithImage(){
            $( '.kudos' ).each(function( index ) {
                    var frontCandles = $(this).text();
                    if (frontCandles == 1){
                         $(this).css("background-image","url('css/kudos/candle1Stolen.gif')");
                    } else if (frontCandles == 2) {
                         $(this).css("background-image","url('css/kudos/candle02b.gif')");
                    } else if (frontCandles == 3) {
                         $(this).css("background-image","url('css/kudos/candle03b.gif')");
                    } else if ((frontCandles > 3) && (frontCandles < 8)) {
                         $(this).css("background-image","url('css/kudos/emerald.gif')");
                    } else if ((frontCandles >= 8) && (frontCandles <= 15)) {
                         $(this).css("background-image","url('css/kudos/bat.gif')");
                    } else if (frontCandles >= 16) {
                         $(this).css("background-image","url('css/kudos/diamond.gif')");
                    }

            });
        }



        //candlight trick
    		// $("#skullWall").mousemove(function(e){
    		// 	$("#skullWall").css('background-position',(e.pageX - 250)+'px '+(e.pageY - 250)+'px');
    		// });

        //name on hover
        $('.skullImage').hover(function (){
                // find the triggering box parent, and it's tooltip child
                $(this).parent().children('.skullName').animate(
                    {
                        opacity: "toggle",      // toggle opacity
                    }
                );
                $(this).parent().children('.kudos').animate(
                    {
                        opacity: .1,      // toggle opacity
                    }
                );
            });

       $('.skullImage').mouseout(function (){
            // find the triggering box parent, and it's tooltip child
            $(this).parent().children('.kudos').animate(
                {
                    opacity: 1,      // toggle opacity
                }
            );
         });

        // click to give candle
        $('.skullImage').click(function(e){
            var target = $(this);
        	var skullSlug = $(this).parent().children('.slug').text();
        	var frontCandles = $(this).parent().children('.kudos').text();
        	frontCandles++;

            //CANDLING SYSTEM
            increaseCandleCount(frontCandles);

            // function refreshCandlesOnPage(var){

            //     //nothing right now
             
            // }

            function increaseCandleCount(t_candles){
                $.ajax({
                    url : 'skulls/'+skullSlug+'/edit',
                    dataType : 'json',
                    type : 'POST',
                    data : {
                        candles : t_candles
                    },
                    success : function(data){
                        console.log(data);
                        //
                    },
                    error : function(error){
                        console.log('error on ajax');
                        target.parent().children('.kudos').text(t_candles);
                        //fix this below.
                        //refreshCandlesOnPage();
                    }

                });
            }



         //    increaseCandleCount(frontCandles);
        	// console.log(skullSlug + " : " + frontCandles);

         //    function increaseCandleCount(data){
                
         //        ajaxRequest(frontCandles, skullSlug, '/edit', function(result){
         //            // get ajax data for this skull, get candles, write to var, return that var to kudos
         //            $.ajax({
         //                url: '/skulls/'+skullSlug+'/data',
         //                dataType : 'json',
         //                context: this,
         //                success : function(response){
         //                    console.log('updating anyways')
         //                    console.log(response.skulls.candles);
         //                    console.log(target);
         //                    target.parent().children('.kudos').text(response.skulls.candles);
                            
         //                }
         //            });
         //        });
         //    };
         //        function ajaxRequest(t_candles, slug, task, callback){
         //        $.ajax({
         //            url : '/skulls/'+skullSlug+task,
         //            dataType : 'json',
         //            type : 'POST',
         //            data : {
         //                candles : t_candles
         //            },
         //             success : function(data){
         //                console.log('candled Up');
         //                callback(frontCandles);
         //             },
         //             error : function(xhr, status, error){
         //                console.log(xhr,status,error);
         //                console.log("something is f'd");
         //                callback(frontCandles);
         //             }
         //          // preventDefault();
         //          // return false;
         //        });
         //    };

        });
   	});
</script>